
<h1 class="heading">Projects</h1>
<% if user_signed_in? %>
  <%if current_user.role=="Manager" %>
    <h1 style="margin-top: 40px" class="heading">Projects List</h1>
<table class="table table-striped table-hover">
  <thead class="thead-dark ">
  <tr>
  <th>Project Title</th>
  <th>Project Type</th>
    <th>Assigned Developer</th>
    <th>Assigned QA</th>
    <th>View Bugs</th>
    <th></th>
    <th></th>
  </thead>
  </tr>
  <tbody>

   <% @projects.each do |p| %>
    <tr>
      <td><%=p.title %></td>
      <td><%=p.project_type %></td>

<!--      <td><%#=p.id %></td>-->
      <%# developer = @user.find_by(User.where(role:"Developer")) %>
<!--      <td><%#= p.assign_developer %></td>-->
      <% if p.assign_developer != nil %>
      <% developer = User.find(p.assign_developer) %>
      <td><%= developer.name %></td>
<% else %>
        <td></td>
        <% end %>
      <% if !p.assign_qa.present? %>
        <td><p>Not </p></td>
      <% elsif p.assign_qa.present?%>
        <% qa = User.find(p.assign_qa) %>
        <td><%= qa.name %></td>
      <% end %>
      <td><%=link_to 'view bugs', project_bugs_path(project_id:p.id)  %></td>
      <td><%=link_to 'edit', edit_project_path(p.id) %></td>
      <td><%=link_to 'delete', p, method: :delete %></td>

    <% end %>
    </tr>
  </tbody>
</table>
    <%elsif current_user.role=="QA" %>
    <table class="table table-striped table-hover">
      <thead class="thead-dark ">
      <tr>
        <th>Project Title</th>
        <th>Project Type</th>
        <th>Assigned Developer</th>
        <th></th>
        <th>View Bugs</th>
      </thead>
      </tr>
      <tbody>
    <%@projects.each do |p| %>
        <tr>
        <td> <%= p.title %></td>
        <td><%= p.project_type %></td>
          <% if p.assign_developer == nil %>
            <td><p>Not </p></td>
          <% elsif p.assign_developer != nil%>
            <% developer = User.find(p.assign_developer) %>
            <td><%= developer.name %></td>
          <% end %>
             <td><%=link_to 'raise bug', new_project_bug_path(project_id:p.id) %></td>
             <td><%=link_to 'view bugs', project_bugs_path(project_id:p.id) %></td>
      <%end %>
      </tr>
      </tbody>
    </table>
  <%elsif current_user.role=="Developer" %>
    <table class="table table-striped table-hover">
      <thead class="thead-dark ">
      <tr>
        <th>Project Title</th>
        <th>Project Type</th>
        <th>Assigned QA</th>

      </thead>
      </tr>
      <tbody>
      <%@projects.each do |p| %>
        <%#if p.id ==current_user.id %>
        <tr>
          <td> <%= p.title %></td>
          <td><%= p.project_type %></td>
          <% if p.assign_qa != nil %>
            <% qa = User.find(p.assign_qa) %>
            <td><%= qa.name %></td>
          <% else %>
            <td></td>
          <% end %>

          <%if p.bugs.present? %>
          <td><%=link_to 'See bug', project_bugs_path(p) %></td>
            <%else %>
            <td><p>No Bug raised</p></td>
          <%end %>
          <%#end %>
      <%end %>

    <%end %>
  </tr>
  </tbody>
  </table>

<%end %>