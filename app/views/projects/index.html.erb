


<% if user_signed_in? %>
  <h1 class="heading bgc">Projects List</h1>
  <%if current_user.role=="Manager" %>

<table class="table table-striped table-hover">
  <thead class="thead-light ">
  <tr>
    <th>Project Title</th>
    <th>Project Type</th>
    <th>Assigned Developer</th>
    <th>Assigned QA</th>
    <th>View Bugs</th>
    <th>Edit Project</th>
    <th>Delete Project</th>
  </tr>
  </thead>

  <tbody>

   <% @projects.each do |p| %>
    <tr>
      <td><%=p.title %></td>
      <td><%=p.project_type %></td>

<!--      <td><%#=p.id %></td>-->
      <%# developer = @user.find_by(User.where(role:"Developer")) %>
<!--      <td><%#= p.assign_developer %></td>-->
      <% if p.assign_developer != nil %>
        <%devs = JSON.parse(p.assign_developer) %>
        <td>
          <ul>
        <%devs.each do|d| %>

          <% developer = User.find(d) %>


            <li><%= developer.name %> </li>
            <%end %>
            </ul>





        </td>
<% else %>
        <td></td>
        <% end %>
      <% if !p.assign_qa.present? %>
        <td><p>Not Assigned </p></td>
      <% elsif p.assign_qa.present?%>
        <%qa = JSON.parse(p.assign_qa) %>
        <td>
        <%qa.each do|d| %>
        <% qa = User.find(d) %>

          <ul>
            <li><%= qa.name %></li>
          </ul>
          <%end %>
        </td>
      <% end %>
      <td><%=link_to '<i class="fa fa-eye" aria-hidden="true"></i>'.html_safe, project_bugs_path(project_id:p.id), class:"icon_color"  %></td>
      <td><%=link_to '<i class="fas fa-edit"></i>'.html_safe, edit_project_path(p.id),class:"icon_color" %></td>
<!--      <td><%#=button_to 'delete', project_path(p), :method => :delete,  confirm: "Are you sure", class:"btn btn-danger" %></td>-->
     <td> <%= button_to("Delete", project_path(p), {:onclick => "return confirm('Are you sure?')", :method => :delete, :remote => true,class:"btn btn-danger"} ) %></td>

  <% end %>
    </tr>
  </tbody>
</table>
    <%elsif current_user.role=="QA" %>
    <table class="table table-striped table-hover">
      <thead class="thead-light ">
      <tr>
        <th>Project Title</th>
        <th>Project Type</th>
        <th>Assigned Developer</th>
        <th>Assigned QA</th>
        <th>Raise Bug</th>
        <th>View Bugs</th>
      </thead>
      </tr>
      <tbody>
    <%@projects.each do |p| %>
        <tr>

        <td> <%= p.title %></td>
        <td><%= p.project_type %></td>
          <% if p.assign_developer == nil %>
            <td><p>Not </p></td>
          <% elsif p.assign_developer != nil%>
            <%devs = JSON.parse(p.assign_developer) %>
            <td>
              <ul>
              <%devs.each do|d| %>

                <% developer = User.find(d) %>


                  <li><%= developer.name %> </li>
                <%end %>
                </ul>

              <%qa = JSON.parse(p.assign_qa) %>
            <td>
              <ul>
                <%qa.each do|d| %>
                  <% qa = User.find(d) %>

                  <li><%= qa.name %></li>
                <%end %>
              </ul>

            </td>



            </td>
          <% end %>
             <td><%=link_to 'raise bug', new_project_bug_path(project_id:p.id), class:"icon_color" %></td>
             <td><%=link_to '<i class="fa fa-eye" aria-hidden="true"></i>'.html_safe, project_bugs_path(project_id:p.id),class:"icon_color" %></td>
      <%end %>

      </tr>
      </tbody>
    </table>
  <%elsif current_user.role=="Developer" %>
    <table class="table table-striped table-hover">
      <thead class="thead-light ">
      <tr>
        <th>Project Title</th>
        <th>Project Type</th>
        <th>Assigned Developer</th>
        <th>Assigned QA</th>
        <th></th>
      </thead>
      </tr>
      <tbody>
      <%@projects.each do |p| %>
        <%#if p.id ==current_user.id %>
        <tr>

          <td> <%= p.title %></td>
          <td><%= p.project_type %></td>
          <% if p.assign_developer == nil %>
            <td><p>Not </p></td>
          <% elsif p.assign_developer != nil%>
            <%devs = JSON.parse(p.assign_developer) %>
            <td>
              <ul>
                <%devs.each do|d| %>

                  <% developer = User.find(d) %>


                  <li><%= developer.name %> </li>
                <%end %>
              </ul>
            </td>
          <% if p.assign_qa != nil %>
            <%qa = JSON.parse(p.assign_qa) %>
            <td>
              <ul>
              <%qa.each do|d| %>
                <% qa = User.find(d) %>

                  <li><%= qa.name %></li>
              <%end %>
                </ul>

            </td>
          <% else %>
            <td></td>
          <% end %>
<%end %>
          <%if p.bugs.present? %>
          <td><%=link_to 'See bug', project_bugs_path(p), class:"icon_color" %></td>
            <%else %>
            <td><p>No Bug raised</p></td>
          <%end %>
          <%#end %>
      <%end %>

    <%end %>
  </tr>
  </tbody>
  </table>
<%else %>
  <%= render 'layouts/front' %>
<%end %>